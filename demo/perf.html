<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Perfect Arrow - Perf</title>
    <style>
      html {
        height: 100%;
      }

      body {
        min-height: 100%;
        position: relative;
      }

      draggable-box {
        display: block;
        width: 20px;
        height: 20px;
        border: 3px solid black;
        position: absolute;
      }

      draggable-point {
        display: block;
        width: 5px;
        height: 5px;
        border-radius: 50%;
      }

      perfect-arrow {
        display: block;
        position: absolute;
        top: 0;
        right: 0;
        bottom: 0;
        left: 0;
        pointer-events: none;
      }
    </style>
  </head>
  <body>
    <script type="module">
      import { PerfectArrow } from '../src/perfect-arrow.ts';

      PerfectArrow.register();

      class DraggableBox extends HTMLElement {
        constructor() {
          super();

          this.onMouseDrag = this.onMouseDrag.bind(this);

          this.addEventListener('mousedown', () => {
            window.addEventListener('mousemove', this.onMouseDrag);
          });

          window.addEventListener('mouseup', () => {
            window.removeEventListener('mousemove', this.onMouseDrag);
          });
        }

        onMouseDrag({ movementX, movementY }) {
          const { left, top } = window.getComputedStyle(this);
          let leftValue = parseInt(left);
          let topValue = parseInt(top);
          this.style.left = `${leftValue + movementX}px`;
          this.style.top = `${topValue + movementY}px`;
        }
      }

      customElements.define('draggable-box', DraggableBox);

      const random = (max) => Math.floor(Math.random() * max);

      document.body.append(
        ...Array.from({ length: 50 }).map((_, i) => {
          const box = new DraggableBox();
          box.id = `box${i}`;
          box.style.left = `${random(700)}px`;
          box.style.top = `${random(400)}px`;
          return box;
        }),
        ...Array.from({ length: 250 }).map((_, i) => {
          const arrow = new PerfectArrow();
          arrow.source = `#box${random(50)}`;
          arrow.target = `#box${random(50)}`;
          // arrow.type = 'point';
          return arrow;
        })
      );
    </script>
  </body>
</html>
